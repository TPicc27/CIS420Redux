@using System.Web.UI.WebControls
@using DayPilot.Web.Mvc
@using DayPilot.Web.Mvc.Events.Calendar
@using CIS420Redux.Models;
@using ViewType = DayPilot.Web.Mvc.Enums.Calendar.ViewType

@{ ViewBag.Title = "AJAX Monthly Event Calendar for ASP.NET MVC"; }

<h2>AJAX Monthly Event Calendar for ASP.NET MVC</h2>

<script src="@Url.Content("~/Scripts/daypilot-all.min.js")" type="text/javascript"></script>



@Html.DayPilotMonth("dp", new DayPilotMonthConfig
{
    BackendUrl = Url.Content("~/Calendar/Backend"),
    TimeRangeSelectedHandling = DayPilot.Web.Mvc.Events.Month.TimeRangeSelectedHandlingType.JavaScript,
    TimeRangeSelectedJavaScript = "dp.timeRangeSelectedCallBack(start, end, { name: prompt('New Event Name:', 'New Event')});",
    EventResizeHandling = DayPilot.Web.Mvc.Events.Month.EventResizeHandlingType.CallBack,
    EventMoveHandling = DayPilot.Web.Mvc.Events.Month.EventMoveHandlingType.CallBack,
    EventClickHandling = DayPilot.Web.Mvc.Events.Month.EventClickHandlingType.JavaScript,
    EventClickJavaScript = "editEvent(e.id())"
})

<script type="text/javascript">
    function editEvent(id) {
        var newName = prompt("New event name:", "Event");
        if (!newName) return;

        var props = { "id": id, "titleText": newName };

        $.ajax({
            url: "Calendar/Edit",
            contentType: "application/json",
            async: true,
            type: "POST",
            dataType: "json",
            data: JSON.stringify(props),
            error: function (jqXHR, textStatus, errorThrown) {
                console.log("FAIL: " + errorThrown);
            },
            success: function (data, textStatus, jqXHR) {
                dp.init();
                console.log("SUCCES");
            }
        });
    };

</script>